<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç•™è¨€æ¿ Demo</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#f5f5f5; margin:0; padding:20px; }
    .board { max-width: 800px; margin:0 auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.05); }
    h1 { margin-top:0; }
    .form-row { margin-bottom:10px; display:flex; gap:10px; flex-wrap:wrap; }
    .form-row label { font-size:14px; }
    textarea { width:100%; min-height:80px; resize:vertical; }
    select, input[type="text"], button { padding:6px 8px; font-size:14px; }
    button { cursor:pointer; border:none; border-radius:4px; background:#3498db; color:#fff; }
    button.secondary { background:#eee; color:#333; }
    button.danger { background:#e74c3c; color:#fff; }
    .tag-filter, .tag-list { margin:10px 0; display:flex; flex-wrap:wrap; gap:6px; }
    .tag { padding:3px 8px; border-radius:20px; font-size:12px; border:1px solid #ccc; cursor:pointer; }
    .tag.active { background:#3498db; color:#fff; border-color:#3498db; }
    .message { border-top:1px solid #eee; padding:12px 0; display:flex; gap:10px; }
    .avatar { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:18px; flex-shrink:0; }
    .msg-main { flex:1; }
    .meta { font-size:12px; color:#666; margin-bottom:4px; display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
    .content { margin-bottom:6px; white-space:pre-wrap; word-break:break-word; }
    .actions { font-size:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .actions button { font-size:12px; padding:3px 6px; }
    .tag-label { font-size:11px; padding:2px 6px; border-radius:12px; background:#eee; }
    .reported { background:#fff8e6; }
    .emoji-btns { display:flex; gap:5px; margin-top:4px; flex-wrap:wrap; }
    .emoji-btns button { background:#ffe; border:1px solid #ddd; }
    .small { font-size:11px; color:#999; }
  </style>
</head>
<body>
<div class="board">
  <h1>åŒ¿åç•™è¨€æ¿</h1>
  <p class="small">åŠŸèƒ½ï¼šåŒ¿åï¼‹é ­åƒã€æ¨™ç±¤ã€æŒ‰è®šã€è¡¨ç¬¦ã€é«’è©±éæ¿¾ã€èˆ‰å ±ã€‚</p>

  <!-- ç™¼æ–‡è¡¨å–® -->
  <div id="form">
    <div class="form-row">
      <label>
        æš±ç¨±ï¼ˆå¯ç•™ç™½ï¼åŒ¿åï¼‰ï¼š
        <input type="text" id="nickname" placeholder="åŒ¿å">
      </label>
      <label>
        æ¨™ç±¤ï¼š
        <select id="tag">
          <option value="general">ä¸€èˆ¬</option>
          <option value="confess">å‘Šç™½</option>
          <option value="rant">é åŒ—</option>
          <option value="thanks">æ„Ÿè¬</option>
          <option value="qa">å•å•é¡Œ</option>
        </select>
      </label>
    </div>
    <div class="form-row">
      <textarea id="content" placeholder="æƒ³èªªä»€éº¼ï¼Ÿ"></textarea>
    </div>
    <div class="form-row">
      <div class="emoji-btns">
        <span class="small">å¿«é€Ÿæ’å…¥è¡¨æƒ…ï¼š</span>
        <button type="button" class="secondary emoji">ğŸ˜‚</button>
        <button type="button" class="secondary emoji">ğŸ˜¡</button>
        <button type="button" class="secondary emoji">ğŸ¥¹</button>
        <button type="button" class="secondary emoji">ğŸ‘</button>
        <button type="button" class="secondary emoji">ğŸ’€</button>
      </div>
      <div style="flex:1"></div>
      <button id="submit">é€å‡ºç•™è¨€</button>
    </div>
    <p class="small">ç°¡å–®è¦å‰‡ï¼šä¸è¦å¯¦åç½µäººã€ä¸è¦è²¼å€‹è³‡ï¼Œæœ‰å•é¡Œè«‹ç”¨èˆ‰å ±ã€‚</p>
  </div>

  <!-- æ¨™ç±¤ç¯©é¸ -->
  <div class="tag-filter">
    <span class="small">ç¯©é¸æ¨™ç±¤ï¼š</span>
    <button class="tag active" data-filter="all">å…¨éƒ¨</button>
    <button class="tag" data-filter="general">ä¸€èˆ¬</button>
    <button class="tag" data-filter="confess">å‘Šç™½</button>
    <button class="tag" data-filter="rant">é åŒ—</button>
    <button class="tag" data-filter="thanks">æ„Ÿè¬</button>
    <button class="tag" data-filter="qa">å•å•é¡Œ</button>
  </div>

  <!-- ç•™è¨€åˆ—è¡¨ -->
  <div id="list"></div>
</div>

<script>
  // ====== è¨­å®šå€ ======
  const badWords = ["å¹¹", "é åŒ—", "ç™½ç—´", "æ™ºéšœ"]; // è‡ªå·±æ…¢æ…¢åŠ 
  const avatars = [
    { bg: "#e74c3c", icon: "ğŸ¦Š" },
    { bg: "#3498db", icon: "ğŸ³" },
    { bg: "#9b59b6", icon: "ğŸ±" },
    { bg: "#f1c40f", icon: "ğŸ¤" },
    { bg: "#1abc9c", icon: "ğŸ¸" },
    { bg: "#e67e22", icon: "ğŸ¯" }
  ];

  // ====== ç‹€æ…‹ ======
  let messages = [];
  let currentFilter = "all";

  // å¾ localStorage è¼‰å…¥
  const saved = localStorage.getItem("demoMessages");
  if (saved) {
    try {
      messages = JSON.parse(saved);
    } catch (e) {
      messages = [];
    }
  }

  function save() {
    localStorage.setItem("demoMessages", JSON.stringify(messages));
  }

  // ====== å·¥å…·å‡½å¼ ======
  function getRandomAvatar() {
    const idx = Math.floor(Math.random() * avatars.length);
    return avatars[idx];
  }

  function sanitizeProfanity(text) {
    let result = text;
    badWords.forEach(w => {
      const reg = new RegExp(w, "gi");
      const stars = "ï¼Š".repeat(w.length);
      result = result.replace(reg, stars);
    });
    return result;
  }

  function formatTime(date) {
    return date.getFullYear() + "/" +
      (date.getMonth() + 1) + "/" +
      date.getDate() + " " +
      date.getHours().toString().padStart(2, "0") + ":" +
      date.getMinutes().toString().padStart(2, "0");
  }

  function tagText(tag) {
    switch (tag) {
      case "confess": return "å‘Šç™½";
      case "rant": return "é åŒ—";
      case "thanks": return "æ„Ÿè¬";
      case "qa": return "å•å•é¡Œ";
      default: return "ä¸€èˆ¬";
    }
  }

  // ====== æ¸²æŸ“ ======
  const listEl = document.getElementById("list");

  function render() {
    listEl.innerHTML = "";
    const show = messages.filter(m => currentFilter === "all" || m.tag === currentFilter);
    show.forEach((m, index) => {
      const div = document.createElement("div");
      div.className = "message" + (m.reported ? " reported" : "");
      div.dataset.index = index;

      const avatarDiv = document.createElement("div");
      avatarDiv.className = "avatar";
      avatarDiv.style.background = m.avatar.bg;
      avatarDiv.textContent = m.avatar.icon;

      const main = document.createElement("div");
      main.className = "msg-main";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML =
        `<strong>${m.nickname || "åŒ¿å"}</strong>` +
        `<span>Â· ${formatTime(new Date(m.time))}</span>` +
        `<span class="tag-label">${tagText(m.tag)}</span>` +
        (m.reported ? `<span class="small">å·²è¢«èˆ‰å ±</span>` : "");

      const content = document.createElement("div");
      content.className = "content";
      content.textContent = m.content; // å·²ç¶“éæ¿¾é«’è©±

      const actions = document.createElement("div");
      actions.className = "actions";

      const likeBtn = document.createElement("button");
      likeBtn.className = "secondary";
      likeBtn.textContent = `ğŸ‘ ${m.likes || 0}`;
      likeBtn.addEventListener("click", () => {
        m.likes = (m.likes || 0) + 1;
        save();
        render();
      });

      const emojiBtn = document.createElement("button");
      emojiBtn.className = "secondary";
      emojiBtn.textContent = `ğŸ’¬ è¡¨æƒ… +1 (${m.emojis || 0})`;
      emojiBtn.addEventListener("click", () => {
        m.emojis = (m.emojis || 0) + 1;
        save();
        render();
      });

      const reportBtn = document.createElement("button");
      reportBtn.className = "danger";
      reportBtn.textContent = "èˆ‰å ±";
      reportBtn.addEventListener("click", () => {
        if (confirm("ç¢ºå®šè¦èˆ‰å ±é€™å‰‡ç•™è¨€å—ï¼Ÿ")) {
          m.reported = true;
          save();
          render();
        }
      });

      actions.appendChild(likeBtn);
      actions.appendChild(emojiBtn);
      actions.appendChild(reportBtn);

      main.appendChild(meta);
      main.appendChild(content);
      main.appendChild(actions);

      div.appendChild(avatarDiv);
      div.appendChild(main);
      listEl.appendChild(div);
    });
  }

  // ====== ç™¼æ–‡äº‹ä»¶ ======
  document.getElementById("submit").addEventListener("click", () => {
    const nickname = document.getElementById("nickname").value.trim();
    const tag = document.getElementById("tag").value;
    const contentRaw = document.getElementById("content").value.trim();

    if (!contentRaw) {
      alert("è«‹å…ˆè¼¸å…¥å…§å®¹");
      return;
    }

    const filtered = sanitizeProfanity(contentRaw);
    const avatar = getRandomAvatar();

    const msg = {
      nickname: nickname || "",
      tag,
      content: filtered,
      time: new Date().toISOString(),
      avatar,
      likes: 0,
      emojis: 0,
      reported: false
    };

    messages.unshift(msg);
    save();
    document.getElementById("content").value = "";
    render();
  });

  // è¡¨æƒ…å¿«é€Ÿæ’å…¥
  document.querySelectorAll(".emoji").forEach(btn => {
    btn.addEventListener("click", () => {
      const t = document.getElementById("content");
      t.value += btn.textContent;
      t.focus();
    });
  });

  // ====== æ¨™ç±¤ç¯©é¸ ======
  document.querySelectorAll(".tag-filter .tag").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tag-filter .tag").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentFilter = btn.dataset.filter;
      render();
    });
  });

  // åˆå§‹åŒ–ç•«é¢
  render();
</script>
</body>
</html>
